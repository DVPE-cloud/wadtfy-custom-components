{{ template "chart.header" . }}
{{ template "chart.versionBadge" . }}

{{ template "chart.description" . }}

## Installation
Installs custom wadtfy tenantfilesystem crossplane XRD on an existing Kubernetes cluster for a specific namespace.

**Preconditions**:
* [Crossplane](https://crossplane.io) need to be installed on Kubernetes.
* The default [AWS Crossplane Provider](https://github.com/crossplane-contrib/provider-aws) is used for provisioning AWS Resources.
* At least three AWS availability zones in the VPC are required to establish an EFS connectivity.

### Add Helm repository

```shell
helm repo add wadtfy-custom-component https://dvpe-cloud.github.io/wadtfy-custom-components
helm repo update
```

## Install wadtfy tenantfilesystem chart

```sh
helm install tenantfilesystem . -f values.yaml
```

## Use TenantFileSystemClaim to create Filesystems

Create a `tenantfilesystemclaim.yaml` and set the Tenant Account related values

Sample:

```yaml
apiVersion: apiextensions.crossplane.io/v1alpha1
kind: tenantfilesystemclaim
metadata:
  name: tenantname-filesystemname
  namespace: tenant-namespace
spec:
  compositionRef:
    name: tenantfilesystem
  # Tenant AWS Account ID
  tenantAccountID: ""
  # Crossplane ProviderConfig from Tenant
  tenantProviderConfig:
  # AWS VPC ID
  vpcId:
  # AWS VPC Subnet ID's
  vpcSubnetIdA:
  vpcSubnetIdB:
  vpcSubnetIdC:
  # AWS Account Region
  region:
  # EFS Performance Mode
  efsPerformanceMode:
  # EFS Throughput Mode
  efsThroughputMode:
  # StorageClass specific values
  storageClass:
    directoryPerms: "700"
    basePath: "/dynamic_provisioning"
  writeConnectionSecretToRef:
    name:
```

```sh
kubectl apply -f environment-sample.yaml
```

## Configuration

The following table lists the configurable parameters of the chart and its default values.

{{ template "chart.valuesSection" . }}
